#!/bin/ksh
##
## List specified files and all parent directories
## Copyright (c) 2013 SATOH Fumiyasu @ OSS Technology Corp., Japan
##
## License: GNU General Public License version 3
##

set -u

if ! type tac >/dev/null 2>&1; then
  tac() { tail -r "$@"; }
fi

typeset -a opts
while [ $# -gt 0 ]; do
  [[ -n "${1##-*}" ]] && break
  opts=("${opts[@]}" "$1")
  shift
done

for fname in "$@"; do
  while :; do
    echo "${fname:-/}"
    dname="${fname%/*}"
    [[ "$dname" = "$fname" ]] && break
    fname="$dname"
  done \
  |tac
done \
|xargs ls -d "${opts[@]}" --

